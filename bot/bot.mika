dofile('./bot/utils.mika')
URL = require('socket.url')
http = require('socket.http')
https = require('ssl.https')
json = dofile('./libs/JSON.lua')
serpent = dofile("./libs/serpent.lua")
MsgTime = os.time() - 60

day = 86400

local url = nil

function dl_cb(arg, data)
end

function GetMessages(msg, data)
    if msg then
        if msg.date < tonumber(MsgTime) then
            --print('OLD MESSAGE')
            return false
        end
        
        if not redis:sismember(my..'AllGroup', msg.chat_id) then --add AllGroup if not exist
            redis:sadd(my..'AllGroup', msg.chat_id)
        end
        
        if chat_type(msg.chat_id) == 'private' then --blocking system for PV
            
            if redis:get(my..'Flood:Pv:'..my) then
                
                if not is_sudo(msg) then
                    
                    local post_count = 'user:' .. msg.sender_user_id .. ':flooder'
                    local msgs = tonumber(redis:get(my..post_count) or 0)
                    
                    if msgs > tonumber(flood_MAX) then
                        
                        if redis:get(my..'user:'..msg.sender_user_id..':flooder') then
                            
                            tdbot.Block(msg.sender_user_id)
                            
                            return false
                            
                        else
                            
                            redis:setex(my..'user:'..msg.sender_user_id..':flooder', 15, true)
                            
                        end
                        
                    end
                    
                    redis:setex(my..post_count, tonumber(TIME_CHECK), msgs + 1)
                    
                end
                
            end
            
        end
        
        ---------------- checking chat ----------------
        if chat_id then
            ---------------- its Super Group ----------------
            local id = tostring(msg.chat_id)
            
            if id:match('-100(%d+)') then
                
                if not redis:sismember(my.."SuperGroup", msg.chat_id) then
                    
                    redis:sadd(my.."SuperGroup", msg.chat_id)
                    redis:sadd(my.."Addtoall", msg.chat_id)
                    
                end
                ---------------- its Group ----------------
            elseif id:match('^-(%d+)') then
                
                if not redis:sismember(my.."Groups", msg.chat_id) then
                    
                    redis:sadd(my.."Groups", msg.chat_id)
                    redis:sadd(my.."Addtoall", msg.chat_id)
                end
                ---------------- its PV----------------
                
            elseif id:match('^(%d+)') then
                
                if not redis:sismember(my.."Users", msg.chat_id) then
                    
                    redis:sadd(my.."Users", msg.chat_id)
                    
                end
                ---------------- any way ----------------
            else
                
                if not redis:sismember(my.."SuperGroup", msg.chat_id) then
                    
                    redis:sadd(my.."SuperGroup", msg.chat_id)
                    
                end
                
            end
            
        end
        ---------------- MSG MATCHES ----------------
        
        local input = msg.content.text --given text
        local InputMediaName = msg.content.text
        local cernerbk = msg.content.text
        
        if input then
            
            chat_id = msg.chat_id
            input = input:lower() --Make uppercase characters lower case.
            
        end
        
        if input then
            
            if input:match('^[-/#!]') then
                
                input = input:gsub('^[-/#!]', '') -- deleting "-/#!"
                
            end
        end
        
        if InputMediaName then
            
            if InputMediaName:match('^[/#!]') then
                
                InputMediaName = InputMediaName:gsub('^[/#!]', '')
                
            end
            
        end
        
        ---------------- Clerk System ----------------
        
        if is_private(msg) and not is_sudo(msg) then
            
            if input and not redis:get(my..'Time'..msg.sender_user_id) then -- second condition : checking for spam
                
                if redis:get(my..'Monshi') and redis:get(my..'MonshiStatus') then -- is Clerk is on
                    
                    if redis:get(my..'MessageClerk') then -- getting Clerk Text
                        
                        textclerk = redis:get(my..'MessageClerk')
                        
                    else -- Clerk Default Text
                        
                        textclerk = 'مشترک مورد نظر در دسترس نمیباشد'
                        
                    end
                    
                    tdbot.sendText(msg.chat_id, msg.id, textclerk, 'md')
                    redis:setex(my..'Time'..msg.sender_user_id, 120, true) -- set spam timer
                    
                end
                
            end
            
        end
        
        if not redis:get(my..'SelfOnline:'..msg.chat_id) then
            
            ---------------- MarkRead System ----------------
            
            if not is_channel(msg) then
                
                if redis:get(my..'MarkRead:') then
                    
                    if input then
                        
                        tdbot.Markread(msg.chat_id, {[0] = msg.id})
                        
                    end
                    
                end
                
                if redis:get(my..'Action:'..msg.chat_id) then
                    
                    if input then
                        
                        tdbot.Action(msg.chat_id, 'Typing')
                        
                    end
                    
                end
                
            end
            
            ---------------- Malevolent - Answer - Echo System ----------------
            
            if is_supergroup(msg) or is_group(msg) then
                
                if redis:get(my..'Malevolent') then
                    
                    for k, v in pairs(badkhah) do
                        
                        if input == v and not is_sudo(msg) then
                            
                            tdbot.sendText(msg.chat_id, msg.id, YML[math.random(#YML)], 'md')
                            
                        end
                        
                    end
                    
                end
                
                if redis:get(my..'Answer') then
                    
                    for k, v in pairs(myname) do
                        
                        if input == v and not is_sudo(msg) then
                            
                            tdbot.sendText(msg.chat_id, msg.id, Answer[math.random(#Answer)], 'md')
                        end
                        
                    end
                    
                end
                
                if redis:get(my..'Echo'..msg.chat_id) then
                    
                    if input and not is_sudo(msg) then
                        
                        tdbot.forwardMessage(msg.chat_id, msg.chat_id, {[0] = msg.id}, 1)
                        
                    end
                    
                end
                
            end
            
            ---------------- define MsgType ----------------
            if msg.content._ == "messageAudio" then
                
                MsgType = 'Audio'
                
            end
            
            if msg.content._ == "messageVoice" then
                
                MsgType = 'Voice'
                
            end
            
            if msg.content._ == "messageVideo" then
                
                MsgType = 'Video'
                
            end
            
            if msg.content._ == "messageAnimation" then
                
                MsgType = 'Gif'
                
            end
            
            if msg.content._ == "messageLocation" then
                
                MsgType = 'Location'
                
            end
            
            if msg.content._ == "messageForwardedFromUser" then
                
                MsgType = 'messageForwardedFromUser'
                
            end
            
            if msg.content._ == "messageContact" then
                
                MsgType = 'Contact'
                
            end
            
            if not msg.reply_markup and msg.via_bot_user_id ~= 0 then
                
                MsgType = 'Markread'
                
            end
            
            if msg.content.game then
                
                MsgType = 'Game'
                
            end
            
            if msg.content._ == "messagePhoto" then
                
                MsgType = 'Photo'
                
            end
            --------------------------------
            
            ---------------- Check for True User Online State ----------------
            
            if redis:get(my..'Monshi') then
                
                function Check(CerNer, Company)
                    
                    if Company.status._ == "userStatusOnline" then
                        
                        print('\027[' ..color.cyan[2] .. ';'..color.white[1] .. 'm                     I am Online                                \027[00m')
                        redis:del(my..'MonshiStatus')
                        
                        local time = os.date("%H : %M")
                        redis:set(my..'Onlined:', time)
                        
                    end
                    
                end
                
                tdbot.getUser(my, Check)
                
            end
            
            if redis:get(my..'Monshi') then
                
                function Check(CerNer, Company)
                    
                    if Company.status._ == "userStatusOffline" then
                        
                        print('\027[' ..color.red[2] .. ';'..color.white[1] .. 'm                     I am Offline                                \027[00m')
                        
                        if not redis:get(my..'MonshiStatus') then
                            
                            redis:set(my..'MonshiStatus', true)
                            
                            local time = os.date("%H : %M")
                            redis:set(my..'Offlined:', time)
                            
                        end
                        
                    end
                    
                end
                
                tdbot.getUser(my, Check)
                
            end
            
            ---------------- Fohsh System ! ----------------
            
            if is_supergroup(msg) then
                
                if is_Enemy(msg) and not is_sudo(msg) then
                    
                    tdbot.sendText(msg.chat_id, msg.id, fohsh[math.random(#fohsh)], 'md')
                    
                end
            end
            
            ---------------- Commands ----------------
            
            ---------------- CMD : response off ----------------
            
            if is_sudo(msg) then
                
                if input == 'response off'then
                    
                    if redis:get(my..'Response:') then
                        
                        tdbot.send(msg.chat_id, msg.id, '*Response* `Has Been Disabled`', 'md')
                        redis:del(my..'Response:')
                        
                    else
                        
                        tdbot.send(msg.chat_id, msg.id, '*Response*  is _Already_  `Disable`', 'md')
                        
                    end
                    
                end
                
                ---------------- CMD : response on ----------------
                
                if input == 'response on' then
                    
                    if redis:get(my..'Response:') then
                        
                        tdbot.send(msg.chat_id, msg.id, '*Response*  is _Already_ `Enable`', 'md')
                        
                    else
                        
                        tdbot.send(msg.chat_id, msg.id, '*Response* `Has Been Enable`', 'md')
                        redis:set(my..'Response:', true)
                        
                    end
                    
                end
                
                ---------------- CMD : self off ----------------
                
                if input == 'self off' and is_sudo(msg) then
                    
                    if redis:get(my..'SelfOnline:'..chat_id) then
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '• `Self`   is _Already_ `Offlined in group !`', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    else
                        
                        tdbot.send(msg.chat_id, msg.id, '• `Self` *Has Been Offlined in group !*', 'md')
                        redis:set(my..'SelfOnline:'..msg.chat_id, true) -- SelfOnline is negative :/
                        
                    end
                    
                end
                
                ---------------- CMD : self on ----------------
                
                if input == 'self on' and is_sudo(msg) then
                    
                    if redis:get(my..'SelfOnline:'..chat_id) then
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '• `Self` *Has Been Onlined in group !*', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                        redis:del(my..'SelfOnline:'..chat_id)
                        
                    else
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '• `Self`  is _Already_  `Onlined in group !`', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                end
                
                ---------------- CMD : help ----------------
                
                if input == 'help' and is_sudo(msg) then
                    
                    local text = [[ :D ]]
                    tdbot.send(chat_id, msg.id, text, 'html')
                    
                end
                
                ---------------- CMD : markread off ----------------
                
                if is_sudo(msg) then
                    
                    if input == 'markread off'then
                        
                        if redis:get(my..'MarkRead:') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Mark Read* `Has Been Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'MarkRead:')
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Mark Reed*  is _Already_  `Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : markread on ----------------
                    
                    if input == 'markread on' then
                        
                        if redis:get(my..'MarkRead:') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Mark Read*  is _Already_ `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Mark Read* `Has Been Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:set(my..'MarkRead:', true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : answer off ----------------
                    
                    if input == 'answer off'then
                        
                        if redis:get(my..'Answer') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Answer* `Has Been Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'Answer')
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Answer*  is _Already_  `Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : answer on ----------------
                    
                    if input == 'answer on' then
                        
                        if redis:get(my..'Answer') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Answer*  is _Already_ `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Answer* `Has Been Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:set(my..'Answer', true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : save ----------------
                    
                    if input == 'save' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function SaveMessage(CerNer, Company)
                            
                            tdbot.forwardMessage(my, msg.chat_id, {[0] = Company.id}, 1)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'The message has been saved in the cloud', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SaveMessage)
                        
                    end
                    
                    ---------------- CMD : clerk off ----------------
                    
                    if input == 'clerk off'then
                        
                        if redis:get(my..'Monshi') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Clerk* `Has Been Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'Monshi')
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Clerk*  is _Already_  `Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : clerk on ----------------
                    if input == 'clerk on' then
                        
                        if redis:get(my..'Monshi') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Clerk*  is _Already_ `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            tdbot.send(msg.chat_id, msg.id, '*Clerk* `Has Been Enable`', 'md')
                            redis:set(my..'Monshi', true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : typing off ----------------
                    
                    if input == 'typing off'then
                        
                        if redis:get(my..'Action:'..msg.chat_id) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Typing* `Has Been Disabled`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'Action:'..msg.chat_id)
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Typing*  is _Already_  `Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : typing on ----------------
                    
                    if input == 'typing on' then
                        
                        if redis:get(my..'Action:'..msg.chat_id) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Typing*  is _Already_ `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Typing* `Has Been Enabled`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:set(my..'Action:'..msg.chat_id, true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : flood lock ----------------
                    
                    if input == 'flood lock' then
                        
                        if redis:get(my..'Flood:Pv:'..my) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Flood lock*  is _Already_  `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Flood lock* `Has Been Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:set(my..'Flood:Pv:'..my, true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : malevolent off ----------------
                    
                    if input == 'malevolent off'then
                        
                        if redis:get(my..'Malevolent') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Malevolent* `Has Been Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'Malevolent')
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Malevolent*  is _Already_  `Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : malevolent on ----------------
                    
                    if input == 'malevolent on' then
                        
                        if redis:get(my..'Malevolent') then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '• *Malevolent*  is _Already_ `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '• *Malevolent* `Has Been Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:set(my..'Malevolent', true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : echo off ----------------
                    
                    if input == 'echo off'then
                        
                        if redis:get(my..'Echo'..msg.chat_id) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '• *Echo* `Has Been Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'Echo'..msg.chat_id)
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '•  *Echo*  is _Already_  `Disable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : echo on ----------------
                    
                    if input == 'echo on' then
                        
                        if redis:get(my..'Echo'..msg.chat_id) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '• *Echo*  is _Already_ `Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '• *Echo* `Has Been Enable`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:set(my..'Echo'..msg.chat_id, true)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : bc ----------------
                    if input == 'bc' and tonumber(msg.reply_to_message_id) > 0 then -- send a text to all groups
                        
                        function SendMessageToAllGroup(CerNer, Company)
                            
                            local text = Company.content.text
                            local list = redis:smembers(my..'AllGroup')
                            
                            for k, v in pairs(list) do
                                
                                tdbot.sendText(v, 0, text, 'md')
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SendMessageToAllGroup)
                        
                    end
                    
                    ---------------- CMD : panel ----------------
                    
                    if input == 'panel' then -- self-bot settings
                        
                        local text = '`Settings For SelfBot`' -- main text
                        
                        ----------------
                        if not redis:get(my..'Action:'..msg.chat_id) then -- check for typing system
                            
                            Typing = 'Enable'
                            
                        else
                            
                            Typing = 'Disable'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'MessageClerk') then -- check for clerk text
                            
                            clerk = redis:get(my..'MessageClerk')
                            
                        else
                            
                            clerk = 'مشترک مورد نظر در دسترس نمیباشد'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'MarkReed:') then -- check for markread system
                            
                            Mark = 'Enable'
                            
                        else
                            
                            Mark = 'Disable'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'Echo'..msg.chat_id) then --check for echo system
                            
                            Echo = 'Enable'
                            
                        else
                            
                            Echo = 'Disable'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'Monshi') then -- check for clerk system
                            
                            Clerk = 'Enable'
                            
                        else
                            
                            Clerk = 'Disable'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'Answer') then -- check for answer system
                            
                            Answer = 'Enable'
                            
                        else
                            
                            Answer = 'Disable'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'Flood:Pv:'..my) then -- check for PV anti spam system
                            
                            flood = 'Enable'
                            
                        else
                            
                            flood = 'disable'
                            
                        end
                        ----------------
                        ----------------
                        if redis:get(my..'Malevolent') then -- check for malevolent system
                            
                            Malevolent = 'Enable'
                            
                        else
                            
                            Malevolent = 'Disable'
                            
                        end
                        ----------------
                        
                        local totalredis = io.popen("du -h /var/lib/redis/dump.rdb"):read("*a") -- get size of redis file
                        sizered = string.gsub(totalredis, "/var/lib/redis/dump.rdb", "") -- format $totalredis
                        
                        local totalbot = io.popen("du -h ./bot/bot.mika"):read("*a") -- get size of bot.mika (source)
                        SourceSize = string.gsub(totalbot, "./bot/bot.mika", "") -- format $totalbot
                        
                        local timeoff = redis:get(my..'Offlined:') or 'نامعلوم'
                        
                        local timeon = redis:get(my..'Onlined:') or 'نامعلوم'
                        
                        text = text..'\n\n☢️ Typing ~ '..Typing..'\n\n✅Markread ~ '..Mark..'\n\n📛Malevolent ~ '..Malevolent..'\n\n📣Answer ~ '..Answer..'\n\n🔈Echo ~ '..Echo..'\n\n👩‍⚕Clerk ~ '..Clerk..'\n\nClerk Message : '..clerk..'\n\n[ ⏸Onlined ~ '..timeon..' ]\n\n[ ▶️Offlined ~ '..timeoff..' ]\n\nPersonal security : \n{\nFlood : '..flood..'\nFlood max : '..flood_MAX..'\nTime Check : '..TIME_CHECK..'\n}\nRedis Size : '..sizered..'\nSource Size : '..SourceSize
                        
                        tdbot.send(msg.chat_id, msg.id, text, 'md')
                        
                    end
                    
                    ---------------- CMD : mydel ----------------
                    
                    if input == 'mydel' then
                        
                        tdbot.deleteMessagesFromUser(msg.chat_id, msg.sender_user_id)
                        
                    end
                    
                    ---------------- CMD : setclerkmessage | CMD : scm ----------------
                    if input == 'setclerkmessage' or input == 'scm' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function SetClerkMessage(CerNer, Company)
                            
                            redis:set(my..'MessageClerk', Company.content.text)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done ! \nClerk Message Has been saved !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SetClerkMessage)
                        
                    end
                    
                    ---------------- CMD : set flood ----------------
                    
                    if input and input:match('^set flood (%d+)') then
                        
                        local num = input:match('^set flood (%d+)')
                        
                        if tonumber(num) < 2 then
                            
                            tdbot.send(msg.chat_id, msg.id, " Select a number *Greater* than `2` !", "md")
                            
                        else
                            
                            redis:set(my..'Flood:Max:'..my, num)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, "Flood *Sensitivity* Changed to `" ..num.. "` !", "md")
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : set floodtime ----------------
                    
                    if input and input:match('^set floodtime (%d+)') then
                        
                        local num = input:match('^set floodtime (%d+)')
                        
                        if tonumber(num) < 2 then
                            
                            tdbot.send(msg.chat_id, msg.id, " Select a number *Greater* than `2` !", "md")
                            
                        else
                            
                            redis:set(my..'Flood:Time:'..my, num)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, "Flood Time *Sensitivity* Changed to `" ..num.. "` !", "md")
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : fwd ----------------
                    
                    if input == 'fwd' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function ForwardMessageToAllGroup(CerNer, Company)
                            
                            local list = redis:smembers(my..'AllGroup')
                            
                            for k, v in pairs(list) do
                                
                                tdbot.forwardMessage(v, msg.chat_id, {[0] = Company.id}, 1)
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), ForwardMessageToAllGroup)
                        
                    end
                    
                    ---------------- CMD : set gif ----------------
                    
                    if input and input:match('^set gif (.*)') and tonumber(msg.reply_to_message_id) > 0 then
                        
                        local cmd = input:match('^set gif (.*)')
                        
                        function SaveGifAndCMD(CerNer, Company)
                            
                            if Company.content._ == 'messageAnimation' then
                                
                                local gif = Company.content.animation.animation.persistent_id
                                
                                redis:set(my..'Gifs:'..cmd, gif)
                                redis:sadd(my..'GifsCloud:', cmd)
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done\nGif : '..cmd..' Has been Saved', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            else
                                
                                tdbot.send(msg.chat_id, msg.id, 'Error not found !', 'md')
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SaveGifAndCMD)
                        
                    end
                    
                    ---------------- CMD : del gif ----------------
                    if input and input:match('^del gif (.*)') then
                        
                        local gif = input:match('^del gif (.*)')
                        
                        redis:del(my..'Gifs:'..gif)
                        redis:srem(my..'GifsCloud:', gif)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'Done\nGif : '..gif..' Has been Deleted !', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : gifs ----------------
                    
                    if input == 'gifs' then
                        
                        local GifsCloud = redis:smembers(my..'GifsCloud:')
                        
                        local t = 'gifs: \n'
                        
                        for k, v in pairs(GifsCloud) do
                            
                            t = t..k.." - `"..v.."`\n"
                            
                        end
                        
                        if #GifsCloud == 0 then
                            
                            t = 'Empty'
                            
                        end
                        
                        tdbot.send(msg.chat_id, msg.id, t, 'md')
                        
                    end
                    
                    ---------------- CMD : [gif name] ----------------
                    
                    if InputMediaName and redis:get(my.."Gifs:"..InputMediaName) then
                        
                        local s = redis:get(my.."Gifs:"..InputMediaName)
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        tdbot.sendGif(msg.chat_id, msg.reply_to_message_id or msg.id, s, '')
                        
                    end
                    
                    ---------------- CMD : save ----------------
                    
                    if input and input:match('^save (.*)') and tonumber(msg.reply_to_message_id) > 0 then
                        
                        local get = input:match('^save (.*)')
                        
                        function Save(CerNer, Company)
                            
                            if Company.content._ == 'messageDocument' then
                                
                                redis:set(my.."DOC:"..get, Company.content.document.document.persistent_id)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Document')
                                redis:set(my.."FileSize:"..get, Company.content.document.document.size)
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Document', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messagePhoto' then
                                
                                redis:set(my.."PHOTO:"..get, Company.content.photo.sizes[0].photo.persistent_id)
                                redis:set(my.."FileSize:"..get, Company.content.photo.sizes[0].photo.size)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Photo')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Photo', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messageAnimation' then
                                
                                local gif = Company.content.animation.animation.persistent_id
                                
                                redis:set(my..'GIFS:'..get, gif)
                                redis:set(my.."FileSize:"..get, Company.content.animation.animation.size)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Gif')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Gif', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messageVideo' then
                                
                                redis:set(my.."VIDEO:"..get, Company.content.video.video.persistent_id)
                                redis:set(my.."FileSize:"..get, Company.content.video.video.size)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Video')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Video', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messageAudio' then
                                
                                redis:set(my.."AUDIO:"..get, Company.content.audio.audio.persistent_id)
                                redis:set(my.."FileSize:"..get, Company.content.audio.audio.size)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Audio')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Audio', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messageVoice' then
                                
                                redis:set(my.."VOICE:"..get, Company.content.voice.voice.persistent_id)
                                redis:set(my.."FileSize:"..get, Company.content.voice.voice.size)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Voice')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Voice', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messageVideoNote' then
                                
                                redis:set(my.."VIDEONOTE:"..get, Company.content.video_note.video.persistent_id)
                                redis:set(my.."FileSize:"..get, Company.content.video_note.video.size)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'VideoNote')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : VideoNote', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            elseif Company.content._ == 'messageContact' then
                                
                                redis:set(my.."Contact:"..get, Company.content.contact.phone_number)
                                redis:sadd(my.."Files:", get)
                                redis:set(my..'filetype:'..get, 'Contact')
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done! File saved !\nFor getfile  : get '..get..'\nTypeFile : Contact', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            else
                                
                                tdbot.send(msg.chat_id, msg.id, 'Error not found !', 'md')
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), Save)
                        
                    end
                    
                    ---------------- CMD : files ----------------
                    
                    if input == 'files' then
                        
                        local files = redis:smembers(my..'Files:')
                        
                        local ww = io.popen('cd DWN && ls'):read("*all") or 'Empty' -- i don't know why not "ls DWN" :|
                        
                        local t = 'Files: in Dwn folder : \n'..ww..'\nFiles: in Database : \n'
                        
                        for k, v in pairs(files) do
                            
                            local sixe = redis:get(my.."FileSize:"..v) or ''
                            
                            local type = redis:get(my..'filetype:'..v) or 'UnSupported'
                            
                            t = t..k.." - *"..v.."*  Type > `"..type.."`  *"..sixe.."* KB\n"
                            
                        end
                        
                        if #files == 0 then
                            
                            t = 'Empty'
                            
                        end
                        
                        tdbot.send(msg.chat_id, msg.id, t, 'md')
                        
                    end
                    
                    ---------------- CMD : clean files ----------------
                    
                    if input == 'clean files' then
                        
                        local files = redis:smembers(my..'Files:')
                        
                        local t = 'Done \n'
                        
                        for k, v in pairs(files) do
                            
                            t = t..#files.." Files deleted\n"
                            
                            redis:srem(my..'Files:', v)
                            redis:del(my.."FileSize:"..v)
                            redis:del(my..'filetype:'..v)
                            
                        end
                        
                        if #files == 0 then
                            
                            t = 'Empty'
                            
                        end
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, t, 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : set sitcker ----------------
                    
                    if input and input:match('^set sitcker (.*)') and tonumber(msg.reply_to_message_id) > 0 then
                        
                        local cmd = input:match('^set sitcker (.*)')
                        
                        function SaveStickerAndCMD(CerNer, Company)
                            
                            if Company.content._ == 'messageSticker' then
                                
                                redis:set(my..'STICKERS:'..cmd, Company.content.sticker.sticker.persistent_id)
                                redis:sadd(my..'StickersCloud:', cmd)
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done\nSticker : '..cmd..' Has been Saved', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SaveStickerAndCMD)
                        
                    end
                    
                    ---------------- CMD : stickers ----------------
                    
                    if input == 'stickers' then
                        
                        local StickersCloud = redis:smembers(my..'StickersCloud:')
                        
                        local t = 'Stickers: \n'
                        
                        for k, v in pairs(StickersCloud) do
                            
                            t = t..k.." - `"..v.."`\n"
                            
                        end
                        
                        if #StickersCloud == 0 then
                            
                            t = 'Empty'
                            
                        end
                        
                        tdbot.send(msg.chat_id, msg.id, t, 'md')
                        
                    end
                    
                    ---------------- CMD : del sticker ----------------
                    
                    if input and input:match('^del sticker (.*)') then
                        
                        local sticker = input:match('^del sticker (.*)')
                        
                        redis:del(my..'STICKERS:'..sticker)
                        redis:srem(my..'StickersCloud:', sticker)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'Done\nSticker : '..sticker..' Has been Deleted !', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : [sticker name] ----------------
                    
                    if InputMediaName and redis:get(my.."STICKERS:"..InputMediaName) then
                        
                        local s = redis:get(my.."STICKERS:"..InputMediaName)
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        tdbot.sendSticker(msg.chat_id, msg.reply_to_message_id or msg.id, s)
                        
                    end
                    
                    ---------------- CMD : get ----------------
                    
                    if input and input:match('^get (.*)') then
                        
                        local get = input:match('^get (.*)')
                        
                        if redis:get(my.."DOC:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."DOC:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendDocument(chat_id, 0, file, 'File name : '..get..'\nFile Size : '..Size..' KB')
                            
                        elseif redis:get(my.."GIFS:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."GIFS:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendGif(msg.chat_id, msg.reply_to_message_id or msg.id, file, 'File name : '..get..'\nFile Size : '..Size..' KB')
                            
                        elseif redis:get(my.."VIDEONOTE:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."VIDEONOTE:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendVideoNote(msg.chat_id, 0, file)
                            
                        elseif redis:get(my.."Contact:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."Contact:"..get)
                            
                            tdbot.sendContact(msg.chat_id, 0, file, 'Nil', '#CerNerCompany', 0)
                            
                        elseif redis:get(my.."VOICE:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."VOICE:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendVoice(msg.chat_id, 0, file, 'File name : '..get..'\nFile Size : '..Size..' KB')
                            
                        elseif redis:get(my.."AUDIO:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."AUDIO:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendAudio(msg.chat_id, 0, file, 'File name : '..get..'\nFile Size : '..Size..' KB')
                            
                        elseif redis:get(my.."PHOTO:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."PHOTO:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendPhoto(msg.chat_id, 0, file, 'File name : '..get..'\nFile Size : '..Size..' KB')
                            
                        elseif redis:get(my.."VIDEO:"..get) then
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                            local file = redis:get(my.."VIDEO:"..get)
                            local Size = redis:get(my.."FileSize:"..get)
                            
                            tdbot.sendVideo(msg.chat_id, 0, file, 'File name : '..get..'\nFile Size : '..Size..' KB')
                            
                        else
                            
                            tdbot.send(msg.chat_id, msg.id, 'Error not found !', 'md')
                            
                        end
                        
                    end
                    
                    ---------------- CMD : boobs ----------------
                    if input == "boobs" then
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        
                        url = getRandomBoobs() or getRandomButts()
                        
                        if url ~= nil then
                            
                            local url = DownloadFile(url, 'DWN/boobs.png')
                            
                            tdbot.sendPhoto(msg.chat_id, 0, url, '')
                        else
                            
                            tdbot.send(msg.chat_id, msg.id, 'Error , Something Went Wrong !', 'md')
                            
                        end
                        
                    end
                    
                    --------------------------------------------------------------------
                    
                    ---------------- i need to add a download system :| ----------------
                    
                    --------------------------------------------------------------------
                    
                    ---------------- CMD : calc ----------------
                    
                    if input and input:match('^calc (.*)') then
                        
                        local calca = input:match('^calc (.*)')
                        
                        Calculate(msg, calca)
                        
                    end
                    
                    ---------------- CMD : backup ----------------
                    
                    if input == 'backup' then
                        
                        tdbot.sendDocument(my, 0, './bot/bot.mika', 'Bot.lua')
                        tdbot.sendDocument(my, 0, './bot/utils.mika', 'utils.lua')
                        tdbot.sendDocument(my, 0, './bot/function.cerner', 'function.lua')
                        tdbot.sendDocument(my, 0, '/var/lib/redis/dump.rdb', 'redis.rdb')
                        tdbot.send(msg.chat_id, msg.id, 'Sented!', 'md')
                        
                    end
                    
                    ---------------- CMD : del file ----------------
                    if input and input:match('^del file (.*)') then
                        
                        local get = input:match('^del file (.*)')
                        
                        if redis:get(my.."DOC:"..get) then
                            
                            redis:del(my.."DOC:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."GIFS:"..get) then
                            
                            redis:del(my.."GIFS:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."VIDEONOTE:"..get) then
                            
                            redis:del(my.."VIDEONOTE:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."Contact:"..get) then
                            
                            redis:del(my.."Contact:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."VOICE:"..get) then
                            
                            redis:del(my.."VOICE:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."AUDIO:"..get) then
                            
                            redis:del(my.."AUDIO:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."PHOTO:"..get) then
                            
                            redis:del(my.."PHOTO:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        elseif redis:get(my.."VIDEO:"..get) then
                            
                            redis:del(my.."VIDEO:"..get)
                            redis:srem(my.."Files:", get)
                            redis:del(my..'filetype:'..get)
                            redis:del(my.."FileSize:"..get)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Done\nFile  : '..get..' Has been Deleted !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            tdbot.send(msg.chat_id, msg.id, 'Error not found !', 'md')
                            
                        end
                        
                    end
                    
                    ---------------- CMD : delallfrom | daf ----------------
                    if input == 'delall' or input == 'daf' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function DelallByReply(CerNer, Company)
                            
                            tdbot.deleteMessagesFromUser(msg.chat_id, Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '`All messages user :` *'..Company.sender_user_id..'* Has Been *Deleted* ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), DelallByReply)
                        
                    end

                    ---------------- CMD : tr ----------------
                    if input and input:match('^tr (.*) (.*)') then 

                        print('tr')
                       
                        local lang , text = input:match('^tr (.*) (.*)')
                       
                        local url = https.request('https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20160119T111342Z.fd6bf13b3590838f.6ce9d8cca4672f0ed24f649c1b502789c9f4687a&format=plain&lang='..lang..'&text='..text)
                       
                        local data = json:decode(url)
                       
                        local output = 'زبان : '..data.lang..'\nترجمه : '..data.text[1]..'\n____________________'
                    
                        tdbot.send(msg.chat_id,msg.id,output,'md')

                    end
                    
                    ---------------- CMD : reload ----------------
                    
                    if input == 'reload' then
                        
                        for k, v in pairs(reloading) do
                            
                            tdbot.send(msg.chat_id, msg.id, v, 'md')
                            
                        end

                        local pull = assert(io.popen('git pull', 'r'))
                        local pullResult = pull:read('*all')
                        pull:close()

                        tdbot.sendText(msg.chat_id,0,pullResult,'html')
                        
                        dofile('./bot/bot.mika')
                        
                        dofile('./bot/function.cerner')
                        
                    end
                    
                    ---------------- CMD : dump ----------------
                    if input == 'dump' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function VarDump(CerNer, Company)
                            
                            local TeXT = serpent.block(Company, {comment = false})
                            
                            text = string.gsub(TeXT, "\n", "\n\r\n")
                            
                            tdbot.send(msg.chat_id, msg.id, text, 'html')
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), VarDump)
                        
                    end
                    
                    ---------------- CMD : inv [by reply]----------------
                    
                    if input == 'inv' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function InviteByReply(CerNer, Company)
                            
                            tdbot.addChatMembers(msg.chat_id, Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '`User :` *'..Company.sender_user_id..'* Has Been *Add* to Group', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), InviteByReply)
                        
                    end
                    
                    ---------------- CMD inv ----------------
                    
                    if input and input:match('^inv (%d+)') then
                        
                        local ID = input:match('^inv (%d+)')
                        
                        tdbot.addChatMembers(msg.chat_id, ID)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '`User :` *'..ID..'* Has Been *Add* to Group', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : call [reply]----------------
                    
                    if input == 'call' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function CallByReply(CerNer, Company)
                            
                            tdbot.createCall(Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'Call is ongoing!', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), CallByReply)
                        
                    end
                    
                    ---------------- CMD : call [username]----------------
                    
                    if input and input:match('^call @(.*)') then
                        
                        local username = input:match('^call @(.*)')
                        
                        function CreateCallByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                text = 'Call is ongoing!'
                                
                                tdbot.createCall(Company.id)
                                
                            else
                                
                                text = 'User Not Found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'html')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, CreateCallByUsername)
                        
                    end
                    
                    ---------------- CMD : call [id] ----------------
                    
                    if input and input:match('^call (%d+)') then
                        
                        local ID = input:match('^call (%d+)')
                        
                        tdbot.createCall(ID)
                        
                        if redis:get(my..'Response:') then
                            tdbot.send(msg.chat_id, msg.id, 'Call is ongoing!', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : addtoall ----------------
                    
                    if input and input:match('^addtoall (%d+)') then
                        
                        local ID = input:match('^addtoall (%d+)')
                        local list = redis:smembers(my..'AllGroup')
                        
                        for k, v in pairs(list) do
                            
                            tdbot.addChatMember(v, ID, 5)
                            
                        end
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'done !', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    --------------------------------------------------------------------------------
                    --if cerner and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and cerner:match('^call (.*)')then
                    --local ID = cerner:match('^call (.*)')
                    --id = msg.content.entities[0].type.user_id
                    --tdbot.createCall(id)
                    --tdbot.send(msg.chat_id, msg.id,  'Call is ongoing!', 'md')
                    --end
                    
                    ---------------- realy i cant understand this :|
                    
                    --------------------------------------------------------------------------------
                    
                    ---------------- CMD : inv [username] ----------------
                    
                    if input and input:match('^inv @(.*)') then
                        
                        local username = input:match('^inv @(.*)')
                        
                        function InviteByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                text = 'User '..username.. '  Has Been *Add* to Group'
                                
                                tdbot.addChatMembers(msg.chat_id, Company.id)
                                
                            else
                                
                                text = 'User Not Found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'html')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, InviteByUsername)
                        
                    end
                    
                    ---------------- CMD : kick ----------------
                    
                    if input == 'kick' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function KickUserByReply(CerNer, Company)
                            
                            tdbot.KickUser(msg.chat_id, Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*User :* `'..Company.sender_user_id..'`  Has Been *Kicked* ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), KickUserByReply)
                        
                    end
                    
                    ---------------- CMD : id ----------------
                    
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^id (.*)')then
                        
                        local ID = input:match('^id (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            tdbot.send(msg.chat_id, msg.id, '`'..id..'`', 'md')
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                        
                    end
                    
                    ---------------- CMD : unmute ----------------
                    
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^unmute (.*)')then
                        
                        local ID = input:match('^unmute (.*)')
                        
                        local function Restrictq(CerNer, Company)
                            
                            local Fid = msg.content.entities[0].type.user_id
                            
                            tdbot.Restrict(msg.chat_id, Fid, 'Restricted', {1, 1, 1, 1, 1, 1})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Now User :* `'..ID..'` *can send message and media in group* ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getUser(id, Restrictq)
                        
                    end
                    
                    ---------------- CMD : unmute [username] ----------------
                    
                    if input and input:match('^unmute @(.*)') then
                        
                        local username = input:match('^unmute @(.*)')
                        
                        function RestrictByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                local ID = Company.id
                                
                                text = '*User :* `'..ID..'` *can be send message and media in group* '
                                
                                tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 1, 1, 1, 1, 1})
                                
                            else
                                
                                text = 'Error Not found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, RestrictByUsername)
                        
                    end
                    
                    ---------------- CMD : unmute [reply] ----------------
                    
                    if input == 'unmute' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function UnRestrictUserByReply(CerNer, Company)
                            
                            tdbot.Restrict(msg.chat_id, Company.sender_user_id, 'Restricted', {1, 1, 1, 1, 1, 1})
                            tdbot.send(msg.chat_id, msg.id, '*User :* `'..Company.sender_user_id..'` *can be send message and media in group* ', 'md')
                            
                        end
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), UnRestrictUserByReply)
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*User :* `'..ID..'` *can send message and media in group* ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : unmute [id] ----------------
                    
                    if input and input:match('^unmute (%d+)')then
                        
                        local ID = input:match('^unmute (%d+)')
                        
                        tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 1, 1, 1, 1, 1})
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '*User :* `'..ID..'` *can send message and media in group* ', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : mute links [id] ----------------
                    
                    if input and input:match('^mute links (%d+)')then
                        
                        local ID = input:match('^mute links (%d+)')
                        
                        tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 0, 1, 1, 1, 0})
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..ID..'` *Ristricted* to `send` Links / WebPage Previews ', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : mute links [reply] ----------------
                    
                    if input == 'mute links' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function RestrictUserByReply(CerNer, Company)
                            
                            tdbot.Restrict(msg.chat_id, Company.sender_user_id, 'Restricted', {1, 0, 1, 1, 1, 0})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..Company.sender_user_id..'` *Ristricted* to `send` Links / WebPage Previews ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), RestrictUserByReply)
                        
                    end
                    
                    ---------------- CMD : mute links ----------------
                    
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^mute links (.*)')then
                        
                        local ID = input:match('^mute links (.*)')
                        
                        local function RestrictUserBy(CerNer, Company)
                            
                            local Fid = msg.content.entities[0].type.user_id
                            
                            tdbot.Restrict(msg.chat_id, Fid, 'Restricted', {1, 0, 1, 1, 1, 0})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..Fid..'` *Ristricted* to `send` Links / WebPage Previews ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getUser(id, RestrictUserBy)
                        
                    end
                    
                    ---------------- CMD : mute links [username] ----------------
                    
                    if input and input:match('^mute links @(.*)') then
                        
                        local username = input:match('^mute links@(.*)')
                        
                        function RestrictByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                local ID = Company.id
                                
                                text = '*Now User:* `'..ID..'` *Ristricted* to `send` Links / WebPage Previews '
                                tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 0, 1, 1, 1, 0})
                                
                            else
                                
                                text = 'Error Not found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, RestrictByUsername)
                        
                    end
                    
                    ---------------- CMD : mute ----------------
                    
                    if input == 'mute' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function MuteUserByReply(CerNer, Company)
                            
                            tdbot.Restrict(msg.chat_id, Company.sender_user_id, 'Restricted', {1, 0, 0, 0, 0, 0})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..Company.sender_user_id..'` *Ristricted* to `send` Message', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), MuteUserByReply)
                        
                    end
                    
                    ---------------- CMD : mute ----------------
                    
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^mute (.*)')then
                        
                        local ID = input:match('^mute (.*)')
                        
                        local function Restrictq(CerNer, Company)
                            
                            local Fid = msg.content.entities[0].type.user_id
                            tdbot.Restrict(msg.chat_id, Fid, 'Restricted', {1, 0, 0, 0, 0, 0})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..Fid..'` *Ristricted* to `send` Message ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getUser(id, Restrictq)
                        
                    end
                    
                    ---------------- CMD : mute [username] ----------------
                    
                    if input and input:match('^mute @(.*)') then
                        
                        local username = input:match('^mute @(.*)')
                        
                        function RestrictByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                local ID = Company.id
                                
                                text = '*Now User:* `'..ID..'` *Ristricted* to `send` Message '
                                tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 0, 0, 0, 0, 0})
                                
                            else
                                
                                text = 'Error Not found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, RestrictByUsername)
                        
                    end
                    
                    ---------------- CMD : mute [id] ----------------
                    
                    if input and input:match('^mute (%d+)')then
                        
                        local ID = input:match('^mute (%d+)')
                        
                        tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 0, 0, 0, 0, 0})
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..ID..'` *Ristricted* to `send` Message  ', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    ---------------- CMD : mute media ----------------
                    if input == 'mute media' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function RestrictUserByReply(CerNer, Company)
                            
                            tdbot.Restrict(msg.chat_id, Company.sender_user_id, 'Restricted', {1, 1, 0, 0, 0, 1})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Now User:* `'..Company.sender_user_id..'` *Ristricted* to `send` Media ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), RestrictUserByReply)
                        
                    end
                    
                    ---------------- CMD : mute media ----------------
                    
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^mute media (.*)')then
                        
                        local ID = input:match('^mute media (.*)')
                        local function Restrictq(CerNer, Company)
                            
                            local Fid = msg.content.entities[0].type.user_id
                            
                            tdbot.Restrict(msg.chat_id, Fid, 'Restricted', {1, 1, 0, 0, 0, 1})
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Restrict user :* '..ID..' *from send media in group* ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getUser(id, Restrictq)
                        
                    end
                    
                    ---------------- CMD : mute media ----------------
                    
                    if input and input:match('^mute media (%d+)')then
                        
                        local ID = input:match('^mute media (%d+)')
                        
                        tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 1, 0, 0, 0, 1})
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '*Restrict user :* `'..ID..'` *from send media in group* ', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : mute media [username] ----------------
                    
                    if input and input:match('^mute media @(.*)') then
                        
                        local username = input:match('^mute media @(.*)')
                        
                        function RestrictByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                local ID = Company.id
                                
                                text = '*Restrict user :* `'..ID..'` *from send media in group* '
                                tdbot.Restrict(msg.chat_id, ID, 'Restricted', {1, 1, 0, 0, 0, 1})
                                
                            else
                                
                                text = 'Error Not found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, RestrictByUsername)
                        
                    end
                    ---------------- CMD : res ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^res (.*)')then
                        
                        local ID = msg.content.entities[0].type.user_id
                        
                        local function GetName(CerNer, Company)
                            
                            function Get(extra, result, success)
                                
                                if Company.first_name then
                                    
                                    UserFirstName = ec_name(Company.first_name)
                                    
                                else
                                    
                                    UserFirstName = 'nil'
                                    
                                end
                                
                                if result.about then
                                    
                                    UserBio = check_markdown(result.about)
                                    
                                else
                                    
                                    UserBio = 'nil'
                                    
                                end
                                
                                if result.common_chat_count then
                                    
                                    common_chat_count = result.common_chat_count
                                    
                                else
                                    
                                    common_chat_count = 'nil'
                                    
                                end
                                
                                local text = [[
Firstname : ]] .. UserFirstName .. [[
 
UserName : ]] .. check_markdown(Company.username) .. [[
 
Bio : ]] .. UserBio .. [[
 
Common Chat : ]]..common_chat_count
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            end
                            
                            tdbot.getUserFull(ID, Get)
                            
                        end
                        
                        tdbot.getUser(ID, GetName)
                        
                    end
                    
                    ---------------- CMD : res [id] ----------------
                    
                    if input and input:match('^res (%d+)') then
                        
                        local ID = input:match('^res (%d+)')
                        
                        local function GetName(CerNer, Company)
                            
                            function Get(extra, result, success)
                                
                                if Company.first_name then
                                    
                                    UserFirstName = ec_name(Company.first_name)
                                    
                                else
                                    
                                    UserFirstName = 'nil'
                                    
                                end
                                
                                if result.about then
                                    
                                    UserBio = result.about
                                    
                                else
                                    
                                    UserBio = 'nil'
                                    
                                end
                                
                                if result.common_chat_count then
                                    
                                    common_chat_count = result.common_chat_count
                                    
                                else
                                    
                                    common_chat_count = 'nil'
                                    
                                end
                                
                                local text = [[
Firstname : ]] .. UserFirstName .. [[
 
UserName : ]] .. (check_markdown(Company.username) or 'nil') .. [[
 
Bio : ]] .. UserBio .. [[
 
Common Chat : ]]..common_chat_count
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            end
                            
                            tdbot.getUserFull(ID, Get)
                            
                        end
                        
                        tdbot.getUser(ID, GetName)
                        
                    end
                    
                    ---------------- CMD : kick ----------------
                    
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^kick (.*)')then
                        
                        local ID = input:match('^kick (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '`User :` *'..id..'* Has Been *Kicked* ', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            KickUser(msg.chat_id, id)
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                        
                    end
                    
                    ---------------- CMD : kick [id] ----------------
                    
                    if input and input:match('^kick (%d+)') then
                        
                        local ID = input:match('^kick (%d+)')
                        
                        tdbot.KickUser(msg.chat_id, ID)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '`User :` *'..ID..'* Has Been *Kicked* ', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    if input and input:match('^kick @(.*)') then
                        
                        local username = input:match('^kick @(.*)')
                        
                        function kickbyusername(CerNer, Company)
                            
                            if Company.id then
                                
                                text = 'User '..username.. ' Has Been kicked !'
                                
                                tdbot.KickUser(msg.chat_id, Company.id)
                                
                            else
                                
                                text = 'User Not Found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'html')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, kickbyusername)
                        
                    end
                    
                    ---------------- CMD : flood unlock ----------------
                    if input == 'flood unlock' then
                        
                        if not redis:get(my..'Flood:Pv:'..my) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Flood lock*  is _Already_  Disable', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '*Flood lock* Has Been Disable', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:del(my..'Flood:Pv:'..my)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : set enemy [reply] ----------------
                    if input == 'set enemy' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function SetEnemyByReply(CerNer, Company)
                            
                            if redis:sismember(my..'EnemyList:', Company.sender_user_id) then
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '`User : ` *'..Company.sender_user_id..'* is *Already* `a Enemy..!`', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            else
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '_ User : _ `'..Company.sender_user_id..'` *Added* to `EnemyList` ..', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                                redis:sadd(my..'EnemyList:', Company.sender_user_id)
                                tdbot.Block(Company.sender_user_id)
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SetEnemyByReply)
                        
                    end
                    
                    ---------------- CMD : set enemy [username] ----------------
                    
                    if input and input:match('^set enemy @(.*)') then
                        
                        local username = input:match('^set enemy @(.*)')
                        
                        function SetEnemyByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                local ID = Company.id
                                
                                if redis:sismember(my..'EnemyList:', Company.id) then
                                    
                                    text = '`User : ` *'..Company.id..'* is *Already* `a Enemy !`'
                                    
                                else
                                    
                                    text = '_ User : _ `'..Company.id..'` *Added* to `EnemyList` !'
                                    
                                    tdbot.Block(ID)
                                    redis:sadd(my..'EnemyList:', Company.id)
                                    
                                end
                                
                            else
                                
                                text = 'Error Notfound !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, SetEnemyByUsername)
                        
                    end
                    
                    ---------------- CMD : del enemy [username] ----------------
                    
                    if input and input:match('^del enemy @(.*)') then
                        
                        local username = input:match('^delenemy @(.*)')
                        
                        function RemoveEnemyByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                local ID = Company.id
                                
                                if redis:sismember(my..'EnemyList:', Company.id) then
                                    
                                    text = '_ User : _ `'..ID..'` *Removed* from `EnemyList` ..'
                                    
                                    redis:srem(my..'EnemyList:', ID)
                                    tdbot.Unblock(ID)
                                    
                                else
                                    
                                    text = '`User : ` *'..ID..'* is *Not* ` Enemy..!`'
                                    
                                end
                                
                            else
                                
                                text = 'Error Notfound !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, RemoveEnemyByUsername)
                        
                    end
                    
                    ---------------- CMD : set enemy [id] ----------------
                    if input and input:match('^set enemy (%d+)') then
                        
                        local ID = input:match('^set enemy (%d+)')
                        
                        if redis:sismember(my..'EnemyList:', ID) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '`User : ` *'..ID..'* is *Already* `a Enemy..!`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '_ User : _ `'..ID..'` *Added* to `EnemyList..`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:sadd(my..'EnemyList:', ID)
                            tdbot.Block(ID)
                            
                        end
                        
                    end
                    
                    ---------------- CMD : del enemy [id] ----------------
                    
                    if input and input:match('^del enemy (%d+)') then
                        
                        local ID = input:match('^del enemy (%d+)')
                        
                        if redis:sismember(my..'EnemyList:', ID) then
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '_ User : _ `'..ID..'` *Removed* from `EnemyList` ..', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            redis:srem(my..'EnemyList:', ID)
                            tdbot.Unblock(ID)
                            
                        else
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, '`User : ` *'..ID..'* is *Not* ` Enemy..!`', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                    end
                    
                    ---------------- CMD : set enemy ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^set enemy (.*)')then
                        
                        local ID = input:match('^set enemy (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            if redis:sismember(my..'EnemyList:', id) then
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '`User : ` *'..ID..'* is *Already* `a Enemy..!`', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            else
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '_ User : _ `'..ID..'` *Added* to `EnemyList..`', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                                redis:sadd(my..'EnemyList:', id)
                                
                                tdbot.Block(id)
                                
                            end
                            
                        end
                        
                        tdbot.getUser(ID, GetName)
                        
                    end
                    
                    ---------------- CMD : del enemy ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^del enemy (.*)')then
                        
                        local ID = input:match('^del enemy (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            if redis:sismember(my..'EnemyList:', id) then
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '_ User : _ `'..ID..'` *Removed* from `EnemyList` ..', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                                redis:srem(my..'EnemyList:', id)
                                tdbot.Unblock(id)
                                
                            else
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '`User : ` *'..ID..'* is *Not* ` Enemy..!`', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            end
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                        
                    end
                    
                    ---------------- CMD : del enemy [reply] ----------------
                    if input == 'del enemy' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function SetEnemyByReply(CerNer, Company)
                            
                            if redis:sismember(my..'EnemyList:', Company.sender_user_id) then
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '_ User : _ `'..Company.sender_user_id..'` *Removed* from `EnemyList` ..', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                redis:srem(my..'EnemyList:', Company.sender_user_id)
                                tdbot.Unblock(Company.sender_user_id)
                                
                            else
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '`User : ` *'..Company.sender_user_id..'* is *Not* ` Enemy..!`', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SetEnemyByReply)
                        
                    end
                    
                    ------------------------------------------------------------------------------------------------
                    -------------------------------- Chat Cleaning System ------------------------------------------
                    
                    function cleanbydeleteMessagesFromUser(msg)
                        
                        local function GetAllMembers(arg, data)
                            
                            for k, v in pairs(data.members) do
                                
                                tdbot.deleteMessagesFromUser(msg.chat_id, v.user_id)
                                
                            end
                            
                        end
                        
                        tdbot.getChannelMembers(msg.chat_id, 0, 2000, "Recent", GetAllMembers)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'All Msgs Has Been Cleaned', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    --------------------------------------------------------------------------------
                    
                    function cleanbysearch(msg)
                        
                        local function GetAllMembers(arg, data)
                            
                            for k, v in pairs(data.members) do
                                
                                tdbot.deleteMessagesFromUser(msg.chat_id, v.user_id)
                                
                            end
                            
                        end
                        
                        tdbot.getChannelMembers(msg.chat_id, 0, 2000, "Search", GetAllMembers)
                        
                    end
                    
                    --------------------------------------------------------------------------------
                    
                    function cleanbygetChatHistory(msg)
                        
                        local function cb(arg, data)
                            
                            for k, v in pairs(data.messages) do
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = v.id})
                                
                            end
                            
                        end
                        
                        tdbot.getChatHistory(msg.chat_id, msg.id, 0, 500, cb)
                        
                    end
                    
                    --------------------------------------------------------------------------------
                    --------------------------------------------------------------------------------
                    
                    ---------------- CMD : clean msgs ----------------
                    if input == 'clean msgs' then
                        
                        cleanbydeleteMessagesFromUser(msg)
                        cleanbysearch(msg)
                        cleanbygetChatHistory(msg)
                        
                    end
                    
                    ---------------- CMD : flood ----------------
                    if input and input:match('^flood (%d+)') then
                        
                        function FloodByReply(CerNer, Company)
                            
                            local limit = tonumber(input:match('^flood (%d+)'))
                            
                            for i = 1, limit do
                                
                                tdbot.forwardMessage(msg.chat_id, msg.chat_id, {[0] = msg.reply_to_message_id}, 1)
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), FloodByReply)
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                    end
                    
                    ---------------- CMD : to sticker ----------------
                    if input == 'to sticker' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function tophoto(CerNer, Company)
                            
                            if Company.content._ == "messagePhoto" then
                                
                                local usr = redis:get(my.."UserID")
                                
                                if usr:match("^root$") then
                                    
                                    tg = "/root/.telegram-bot/main"
                                    
                                elseif not usr:match("^root$") then
                                    
                                    tg = "/home/" .. usr .. "/.telegram-bot/main"
                                    tgq = "/home/" .. usr .. "/.telegram-bot/"
                                    
                                end
                                
                                file = Company.content.photo.id
                                
                                local pathf = tg .. "/files/photos/" .. file .. ".jpg"
                                
                                tdbot.sendSticker(msg.chat_id, 0, pathf)
                                tdbot.sendDocument(chat_id, 0, pathf, '')
                                
                            end
                            
                        end
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        tdbot.getMessage(msg.chat_id, msg.reply_to_message_id, tophoto)
                        
                    end
                    
                    ---------------- CMD : block ----------------
                    if input and input:match('^block @(.*)') then
                        
                        local username = input:match('^block @(.*)')
                        
                        function blockbyusername(CerNer, Company)
                            
                            if Company.id then
                                
                                text = 'User `'..username.. '` Has Been blocked !'
                                tdbot.Block(Company.id)
                                
                            else
                                
                                text = 'User Not Found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'html')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, blockbyusername)
                        
                    end
                    
                    ---------------- CMD : unblock [username] ----------------
                    if input and input:match('^unblock @(.*)') then
                        
                        local username = input:match('^unblock @(.*)')
                        
                        function unblockbyusername(CerNer, Company)
                            
                            if Company.id then
                                
                                text = 'User `'..username.. '` Has Been unblocked !'
                                tdbot.Unblock(Company.id)
                                
                            else
                                
                                text = 'User Not Found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'html')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, unblockbyusername)
                        
                    end
                    
                    ---------------- CMD : block [reply] ----------------
                    if input == 'block' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function BlockedByReply(CerNer, Company)
                            
                            tdbot.Block(Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'User `'..Company.sender_user_id..'` Has been blocked !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), BlockedByReply)
                        
                    end
                    
                    ---------------- CMD : unblock [reply] ----------------
                    if input == 'unblock' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function BlockedByReply(CerNer, Company)
                            
                            tdbot.Unblock(Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'User `'..Company.sender_user_id..'` Has been unblocked !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), BlockedByReply)
                        
                    end
                    
                    ---------------- CMD : block [id] ----------------
                    if input and input:match('^block (%d+)') then
                        
                        local id = tonumber(input:match('^block (%d+)'))
                        
                        tdbot.Block(id)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'User `'..id..'` Has been blocked !', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : block [id] ----------------
                    if input and input:match('^unblock (%d+)') then
                        
                        local id = tonumber(input:match('^unblock (%d+)'))
                        
                        tdbot.Unblock(id)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'User `'..id..'` Has been unblocked !', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : block ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^block (.*)')then
                        
                        local ID = input:match('^block (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'User `'..ID..'` Has been blocked !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                            tdbot.Block(id)
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                        
                    end
                    
                    ---------------- CMD : unblock ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^unblock (.*)')then
                        
                        local ID = input:match('^unblock (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            tdbot.Unblock(id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'User `'..ID..'` Has been unblocked !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                    end
                    
                    ---------------- CMD : enemys ----------------
                    if input == 'enemys' then
                        
                        local Cleaner = redis:smembers(my..'EnemyList:')
                        
                        local t = 'EnemyList: \n'
                        
                        for k, v in pairs(Cleaner) do
                            
                            t = t..k.." - `"..v.."`\n"
                            
                        end
                        
                        if #Cleaner == 0 then
                            
                            t = 'Empty'
                            
                        end
                        
                        tdbot.send(msg.chat_id, msg.id, t, 'md')
                        
                    end
                    
                    if input == 'share' then
                        
                        function Share(CerNer, Company)
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = {[0] = msg.id}})
                            tdbot.sendContact(msg.chat_id, msg.id, Company.phone_number, Company.first_name, (Company.last_name or ''), 0)
                            
                        end
                        
                        tdbot.getMe(Share)
                        
                    end
                    
                    ---------------- CMD : addc
                    if input == 'addc' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function SaveCo(CerNer, Company)
                            
                            if Company.content._ == 'messageContact' then
                                
                                tdbot.importContact(Company.content.contact.phone_number, Company.content.contact.first_name, '#CerNerCompany', 0)
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, '`Contact Has Been Saved !`', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SaveCo)
                        
                    end
                    
                    ---------------- CMD : id [reply] ----------------
                    if input == 'id' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function GetID(CerNer, Company)
                            
                            tdbot.send(msg.chat_id, msg.id, '`'..Company.sender_user_id..'`', 'md')
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), GetID)
                        
                    end
                    
                    ---------------- CMD : id ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^id (.*)')then
                        
                        local ID = input:match('^id (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            tdbot.send(msg.chat_id, msg.id, '`'..id..'`\n'..ID, 'md')
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                        
                    end
                    
                    ---------------- CMD : del ----------------
                    if input == 'del' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.reply_to_message_id})
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        
                    end
                    
                    ---------------- CMD : pin ----------------
                    if input == 'pin' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        tdbot.Pin(msg.chat_id, msg.reply_to_message_id, 0)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '`Message has been pinned !`', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : unpin ----------------
                    if input == 'unpin' then
                        
                        tdbot.Unpin(msg.chat_id)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, '`Message has been Unpinned !`', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : name ----------------
                    if input == 'name' and input:match('name (.*)') then
                        
                        local name = input:match('name (.*)')
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        tdbot.changechatname(msg.chat_id, name)
                        
                    end
                    
                    ---------------- CMD : unban [username] ----------------
                    if input and input:match('^unban @(.*)') then
                        
                        local username = input:match('^unban @(.*)')
                        
                        function UnbanByUsername(CerNer, Company)
                            
                            if Company.id then
                                
                                text = 'User `'..username.. '` Has Been unbaned !'
                                tdbot.Unban(Company.id)
                                
                            else
                                
                                text = 'User Not Found !'
                                
                            end
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'html')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(username, UnbanByUsername)
                        
                    end
                    
                    ---------------- CMD : unban [reply] ----------------
                    if input == 'unban' and tonumber(msg.reply_to_message_id) > 0 then
                        
                        function UnbanByReply(CerNer, Company)
                            
                            tdbot.Unban(Company.sender_user_id)
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'User `'..Company.sender_user_id..'` Has been unbaned !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), UnbanByReply)
                        
                    end
                    
                    ---------------- CMD : unban ----------------
                    if input and msg.content.entities and msg.content.entities[0] and msg.content.entities[0].type._ == "textEntityTypeMentionName" and input:match('^unban (.*)')then
                        
                        local ID = input:match('^unban (.*)')
                        
                        local function GetName(CerNer, Company)
                            
                            id = msg.content.entities[0].type.user_id
                            
                            if redis:get(my..'Response:') then
                                
                                tdbot.send(msg.chat_id, msg.id, 'User `'..ID..'` Has been unbaned !', 'md')
                                
                            else
                                
                                tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                
                            end
                            tdbot.Unban(id)
                            
                        end
                        
                        tdbot.getUser(id, GetName)
                    end
                    
                    ---------------- CMD : deletemyacc ----------------
                    if input == 'deletemyacc' and input:match('^deletemyacc (.*)') then
                        
                        local reason = input:match('^deletemyacc (.*)')
                        
                        tdbot.send(msg.chat_id, msg.id, '_Bye_ _Bye_ *^-^*', 'md')
                        tdbot.deleteAccount(reason);
                        
                    end
                    
                    ---------------- CMD : fw ----------------
                    
                    if input == 'fw' then
                        
                        local username = input:match('^fw @(.*)')
                        
                        function FwMessage(CerNer, Company)
                            
                            function FwToUsername(CerNer, Company)
                                
                                if Company.id then
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    tdbot.forwardMessage(my, msg.chat_id, {[0] = Company.id}, 1)
                                    
                                else
                                    
                                    text = 'User Not Found !'
                                    tdbot.send(msg.chat_id, msg.id, text, 'html')
                                    
                                end
                                
                            end
                            
                            tdbot.ResolveUsername(username, FwToUsername)
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), FwMessage)
                        
                    end
                    
                    ---------------- CMD : set voice ----------------
                    
                    if input and input:match('^set voice (.*)') and tonumber(msg.reply_to_message_id) > 0 then
                        
                        local cmd = input:match('^set voice (.*)')
                        
                        function SaveVoiceAndCMD(CerNer, Company)
                            
                            if Company.content._ == 'messageVoice' then
                                
                                redis:set(my..'Voices:'..cmd, Company.content.voice.voice.persistent_id)
                                redis:sadd(my..'VoicesCloud:', cmd)
                                
                                if redis:get(my..'Response:') then
                                    
                                    tdbot.send(msg.chat_id, msg.id, 'Done\nVoice : '..cmd..' Has been Saved', 'md')
                                    
                                else
                                    
                                    tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                                    
                                end
                                
                            end
                            
                        end
                        
                        tdbot.getMessage(msg.chat_id, tonumber(msg.reply_to_message_id), SaveVoiceAndCMD)
                        
                    end
                    
                    ---------------- CMD : voices ----------------
                    
                    if input == 'voices' then
                        
                        local VoicesCloud = redis:smembers(my..'VoicesCloud:')
                        
                        local t = 'Voices : \n'
                        

                        for k, v in pairs(voicesCloud) do
   
                            t = t..k.." - `"..v.."`\n"
                            
                        end
                        
                        if #VoicesCloud == 0 then
                            
                            t = 'Empty'
                            
                        end
                        
                        tdbot.send(msg.chat_id, msg.id, t, 'md')
                        
                    end
                    
                    ---------------- CMD : del voice ----------------
                    
                    if input and input:match('^del voice (.*)') then
                        
                        local voice = input:match('^del voice (.*)')
                        
                        redis:del(my..'Voices:'..voice)
                        redis:srem(my..'VoicesCloud:', voice)
                        
                        if redis:get(my..'Response:') then
                            
                            tdbot.send(msg.chat_id, msg.id, 'Done\nvoice : '..voice..' Has been Deleted !', 'md')
                            
                        else
                            
                            tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                            
                        end
                        
                    end
                    
                    ---------------- CMD : [voice name] ----------------
                    
                    if InputMediaName and redis:get(my.."Voices:"..InputMediaName) then
                        
                        local s = redis:get(my.."Voices:"..InputMediaName)
                        
                        tdbot.deleteMessages(msg.chat_id, {[0] = msg.id})
                        tdbot.sendVoice(msg.chat_id, msg.reply_to_message_id or msg.id, s, "")
                        
                    end
                    
                    if input == 'ping' then
                        
                        tdbot.send(msg.chat_id, msg.id, '*pong*', 'md')

                        
                    end
                    
                    if input and input:match('^id @(.*)') then
                        
                        local UserName = input:match('^id @(.*)')
                        
                        function ID(CerNer, Company)
                            
                            if Company.id then
                                
                                text = '[`'..Company.id..'`]'
                                
                                tdbot.send(msg.chat_id, msg.id, text, 'md')
                                
                            end
                            
                        end
                        
                        tdbot.ResolveUsername(UserName, ID)
                        
                    end
                    
                end
                
            end
            
        end
        
    end
    
end

function tdbot_update_callback(data)
    
    if (data._ == "updateNewMessage") or (data._ == "updateNewChannelMessage") then
        
        GetMessages(data.message, data)
        
        local msg = data.message
        
    elseif (data._ == "updateMessageEdited") then
        
        GetMessages(data.message, data)
        
        data = data
        
        local function edit(sepehr, amir, hassan)
            
            GetMessages(amir, data)
            
        end
        
        assert (tdbot_function ({_ = "getMessage", chat_id = data.chat_id, message_id = data.message_id}, edit, nil))
        assert (tdbot_function ({_ = "openChat", chat_id = data.chat_id}, dl_cb, nil))
        assert (tdbot_function ({_ = "getChats", offset_order = "9223372036854775807", offset_chat_id = 0, limit = 20}, dl_cb, nil))
        
    end
    
end
